function pointerMoveHandler(e){if(!e.dragging){var o="Click to start drawing";if(measureTools.sketch){var t=measureTools.sketch.getGeometry();t instanceof ol.geom.Polygon?o=measureTools.continuePolygonMsg:t instanceof ol.geom.LineString&&(o=measureTools.continueLineMsg)}measureTools.helpTooltipElement.innerHTML=o,measureTools.helpTooltip.setPosition(e.coordinate),measureTools.helpTooltipElement.classList.remove("hidden")}}function formatLength(e){var o,t=ol.Sphere.getLength(e);return o=t>100?Math.round(t/1e3*100)/100+" km":Math.round(100*t)/100+" m"}function formatArea(e){var o,t=ol.Sphere.getArea(e);return o=t>1e4?Math.round(t/1e6*100)/100+" km<sup>2</sup>":Math.round(100*t)/100+" m<sup>2</sup>"}function createHelpTooltip(){measureTools.helpTooltipElement&&measureTools.helpTooltipElement.parentNode.removeChild(measureTools.helpTooltipElement),measureTools.helpTooltipElement=document.createElement("div"),measureTools.helpTooltipElement.className="tooltip hidden",measureTools.helpTooltip=new ol.Overlay({element:measureTools.helpTooltipElement,offset:[15,0],positioning:"center-left"}),map.addOverlay(measureTools.helpTooltip)}function createMeasureTooltip(){measureTools.measureTooltipElement&&measureTools.measureTooltipElement.parentNode.removeChild(measureTools.measureTooltipElement),measureTools.measureTooltipElement=document.createElement("div"),measureTools.measureTooltipElement.className="tooltip tooltip-measure",measureTools.measureTooltip=new ol.Overlay({element:measureTools.measureTooltipElement,offset:[0,-15],positioning:"bottom-center"}),map.addOverlay(measureTools.measureTooltip)}function addInteraction(){var e="area"==measureTools.typeSelect.value?"Polygon":"LineString";measureTools.draw=new ol.interaction.Draw({source:findBy(map.getLayerGroup(),"id","lyr_vector").getSource(),type:e,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}),map.addInteraction(measureTools.draw),createMeasureTooltip(),createHelpTooltip();var o;measureTools.draw.on("drawstart",function(e){measureTools.sketch=e.feature;e.coordinate;o=measureTools.sketch.getGeometry().on("change",function(e){var o,t=e.target;t instanceof ol.geom.Polygon?(o=formatArea(t),measureTools.tooltipCoord=t.getInteriorPoint().getCoordinates()):t instanceof ol.geom.LineString&&(o=formatLength(t),measureTools.tooltipCoord=t.getLastCoordinate()),measureTools.measureTooltipElement.innerHTML=o,measureTools.measureTooltip.setPosition(measureTools.tooltipCoord)})},this),measureTools.draw.on("drawend",function(){measureTools.measureTooltipElement.className="tooltip tooltip-static",measureTools.measureTooltip.setOffset([0,-7]),measureTools.sketch=null,measureTools.measureTooltipElement=null,createMeasureTooltip(),ol.Observable.unByKey(o)},this)}function initMeasure(){map.on("pointermove",pointerMoveHandler),map.getViewport().addEventListener("mouseout",function(){measureTools.helpTooltipElement.classList.add("hidden")}),measureTools.typeSelect.onchange=function(){map.removeInteraction(measureTools.draw),addInteraction()},addInteraction()}var measureTools={};measureTools.sketch,measureTools.helpTooltipElement,measureTools.helpTooltip,measureTools.measureTooltipElement,measureTools.measureTooltip,measureTools.continuePolygonMsg="Click to continue drawing the polygon",measureTools.continueLineMsg="Click to continue drawing the line",measureTools.draw,measureTools.typeSelect=document.getElementById("type"),measureTools.map=window.map;